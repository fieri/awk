% vim: ts=4 sts=4 sw=4 et tw=75
% preamble here.

\documentclass[nofonts, twoside, fancyhdr]{ctexbook}

\usepackage{geometry}
\usepackage{fontspec}
\usepackage{xeCJK}
\usepackage{amssymb}
% for tikz
\usepackage{tikz}
% for varwidth
\usepackage{varwidth}
\usepackage{hyperref}
\usepackage{fancyhdr}
\usepackage{verbatim}
% for float's caption
\usepackage{caption}
% for exercise 
\usepackage{theorem}
% for varwidth
\usepackage{varwidth}
\usepackage{tikz}
% for format of contents
\usepackage{tocloft}
% for number of footnote 
\usepackage{pifont}
% 一页结束时, 脚注编号清零
\usepackage[perpage]{footmisc}
% 边框
\usepackage[framemethod=default]{mdframed}
% 插图所需的宏包
\usepackage{graphicx}
% 
\usepackage[all, pdf]{xy}
% 边框
\usepackage{mdframed}
% 双栏排版
\usepackage{multicol}
% 表格单元格内换行
\usepackage{makecell}
% 有时候, 浮动的边注在双面模式下会出现在错误的一侧, mparhack 可以修正该问题
\usepackage{mparhack}
\usepackage{listings}

\usepackage{pdfpages}
\usepackage{bookmark}

% 脚注编号带圈
\renewcommand\thefootnote{\ding{\numexpr171+\value{footnote}}}

% from package geometry
% 为边注加边框
\let\oldmarginpar=\marginpar
\renewcommand\marginpar[1]{%
    \oldmarginpar{\framebox{#1}}%
}
\geometry{%
    margin=1cm,
    marginparsep = 0.5cm,
    marginparwidth=1cm,
    top = 2cm,
    bottom = 2.5cm,
    outer = 2.5cm,
    footnotesep = 0.8cm,
    footskip=1cm,
    inner = 3.0cm
}

\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\rightmark}
\fancyhead[LO,RE]{\leftmark}
\fancyfoot[LE,RO]{\thepage}

% from package hyperref
\hypersetup{
    colorlinks = false,
    pdfborder = 0 0 0,
    bookmarksnumbered = true,
    pdftitle = {The AWK Programming Language},
    pdfcreator = {wuzhouhui250@gmail.com},
    pdfauthor = {Alfred V. Aho, Brian W. Kernighan, Peter J. Weinberger},
    pdfsubject = {awk programming},
    pdfkeywords = {awk, pattern scanning, text processing}
}

% from package fontspec and xeCJK
\setCJKmainfont[Scale=0.95]{FandolSong}
\setCJKsansfont[Scale=0.95]{FandolSong}
\setCJKmonofont[Scale=0.95]{FandolSong}
\setmainfont{Nimbus Roman No9 L}
\setsansfont{FreeSans}
% "Mapping={}" make quote symbol straight
\setmonofont[Mapping={}]{Ubuntu Mono}

% the name of file or directory
\newcommand\filename[1]{\texttt{#1}}

\newenvironment{awkcode}%
{
    \vspace{-1.0em}
    \verbatim
}%
{
    \endverbatim
    \vspace{-1.0em}
}

% pattern for many situations
\newenvironment{pattern}%
{\vspace{-1.0em}\begin{quotation}}%
{\end{quotation}\vspace{-1.0em}}

% environment for summary
\newenvironment{summary}[1]
{
    \begin{mdframed}
    \begin{center} \Large{#1} \end{center}%
}
{
\end{mdframed}
}

% term in English
\newcommand\term[1]{\textit{#1}}
% term in Chinese
\setCJKfamilyfont{kai}{FandolKai}
\newcommand\cterm[1]{{\CJKfamily{kai}{#1}}}

% subsection unnumbered
%\CTEXsetup[number={}]{subsection}
% 设置 subsection 和 section 的字体为 FandolHei
\setCJKfamilyfont{heiti}{FandolHei}
\CTEXsetup[format={\CJKfamily{heiti}}]{subsection}
\CTEXsetup[format={\CJKfamily{heiti}}]{subsubsection}
\CTEXsetup[format+={\CJKfamily{heiti}}]{section}
\CTEXsetup[format+={\textmd}]{section}

% Looks like subsection's format, reference CTex manual ctex.pdf
\newcommand\pseudosubsec[1]{
    \vspace{3.25ex plus 1ex minus .2ex}
    \noindent{\CJKfamily{heiti}{\phantom{占}#1}}
    \vspace{1.5ex plus .2ex}
    \phantomsection
    \addcontentsline{toc}{subsection}{#1}
}

% word that shows frequently
\newcommand\awk{\texttt{awk}}
\newcommand\print{\texttt{print}}
\newcommand\printf{\texttt{printf}}
\newcommand\nf{\texttt{NF}}
\newcommand\nr{\texttt{NR}}
\newcommand\AND{\texttt{\&\&}}
\newcommand\OR{\texttt{||}}
\newcommand\NOT{\texttt{!}}
\newcommand\BEGIN{\texttt{BEGIN}}
\newcommand\END{\texttt{END}}
\newcommand\length{\texttt{length}}
\newcommand\while{\texttt{while}}
\newcommand\for{\texttt{for}}
\newcommand\patact{\ \mbox{模式}\mbox{--}动作\ }
\newcommand\stmt{\textit{statements}}
\newcommand\expr{\textit{expression}}
\newcommand\regexpr{\textit{regular expression}}
\newcommand\pat{\textit{pattern}}
\newcommand\fs{\texttt{FS}}
\newcommand\OFS{\texttt{OFS}}
\newcommand\ctn{\texttt{continue}}
\newcommand\fmt{\textit{format}}

\theoremstyle{plain}
\theoremheaderfont{\CJKfamily{heiti}}
\theorembodyfont{\normalfont}
\newtheorem{exercise}{\raisebox{0.05em}{习题}}[chapter]
\newcommand\myexer{{\CJKfamily{heiti}{\raisebox{0.05em}{习题}\ }}}

% 设置段间距
\setlength{\parskip}{1ex}

% 设置目录中 subsection 的缩进
%\settowidth\cftsubsecindent{2em}
% 设置目录中 chapter 章节编号的宽度 (ctex 章节编号为中文, 需要特别注意).
% 参考 <<LaTeX 入门>>, 刘海洋 编著, 电子工业出版社, 2013.6
\settowidth\cftchapnumwidth{第十章} % 最宽的可能编号
\renewcommand\cftchapaftersnumb{\hspace{1em}} % 额外间距

% 重新设置目录的字体
\renewcommand\cftchapfont{\CJKfamily{heiti}}

\title{AWK 程序设计语言}
\author{Alfred V.Aho \and Brian W.Kernighan \and Peter J.Weinberger \and
    \url{https://github.com/wuzhouhui/awk}
}
